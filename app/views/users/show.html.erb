<% provide(:title, @user.full_name) %>

<% if current_user.is_admin? %>
    <ol class="breadcrumb">
      <li><%= link_to 'Users', users_path %></li>
      <li class="active"><%= @user.username %></li>
    </ol>
<% end %>

<h1 id="show_user">
  <%= gravatar_for @user %>
  <%= @user.full_name %>
  <small><%= @user.username %></small>
  <% if current_user.is_admin? || current_user == @user %>
      <%= link_to edit_user_path(@user), class: 'btn btn-default btn-sm' do %>
          <%= content_tag(:span, '', class: 'glyphicon glyphicon-pencil') %>
          Edit
      <% end %>
  <% end %>
</h1>

<div>
  <ul class="nav nav-tabs entity_menu">
    <li><a href="#" data-open="info">Info</a></li>
    <li><a href="#" data-open="assessments">Assessments</a></li>
  </ul>

  <section id="info" class="form_view">
    <dl>
      <dt>Institution</dt>
      <dd><%= @user.institution ? @user.institution.name : 'Unaffiliated' %></dd>
      <dt>Email</dt>
      <dd><a href="mailto:<%= @user.email %>"><%= @user.email %></a></dd>
      <dt>Account</dt>
      <dd>
        <%= @user.confirmed ? 'Confirmed' : 'Not Confirmed' %>,
        <%= @user.enabled ? 'Enabled' : 'Disabled' %>
      </dd>
      <dt>Account Created</dt>
      <dd><%= @user.created_at.strftime('%B %e, %Y') %></dd>
      <dt>Last Login</dt>
      <dd>
        <% if @user.last_login %>
            <%= @user.last_login.in_time_zone(@user.time_zone).
                        strftime('%B %e, %Y @ %l:%M %p %Z') %>
        <% else %>
            Never
        <% end %>
      </dd>
    </dl>
  </section>

  <section id="assessments" class="form_view">
    <% if @user.assessments.any? %>
        <table class="table table-striped table-hover">
          <caption>Assessments</caption>
          <thead>
          <th></th>
          <th>Completed</th>
          </thead>
          <tbody>
          <% @user.assessments.order(:name).each do |asst| %>
              <tr>
                <td><%= link_to asst.name, asst %></td>
                <td></td>
              </tr>
          <% end %>
          </tbody>
        </table>
    <% else %>
        <% if @user == current_user %>
            <p>You have not begun any assessments.</p>
        <% else %>
            <p>This user has not begun any assessments.</p>
        <% end %>
    <% end %>
  </section>

</div>
