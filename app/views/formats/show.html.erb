<% provide(:title, @format.name) %>
<% provide(:body_id, 'show_format') %>

<ol class="breadcrumb">
  <li><%= link_to 'Formats', formats_path %></li>
  <li class="active"><%= @format.name %></li>
</ol>

<h1>
  <%= @format.name %>
  <% if @format.format_id_guide_page %>
    <small>
      <%= link_to('(Format ID Guide)',
                  format_id_guide_category_path(@format.format_id_guide_page,
                                                anchor: @format.format_id_guide_anchor),
                  target: '_blank') %>
    </small>
  <% end %>
</h1>

<div class="row">

  <div class="col-sm-4">
    <dl>
      <dt>Class</dt>
      <dd><%= FormatClass.name_for_class(@format.format_class) %></dd>
      <dt>Score</dt>
      <dd><%= @format.score ? @format.score : 'None' %></dd>
      <dt>Temperature Range Scores</dt>
      <dd>
        <table class="table">
          <thead>
            <tr>
              <th>Min (&deg;F)</th>
              <th>Max (&deg;F)</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            <% @format.temperature_ranges.order(:min_temp_f).each do |range| %>
              <tr>
                <td><%= range.min_temp_f %></td>
                <td><%= range.max_temp_f %></td>
                <td><%= range.score %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </dd>
    </dl>
  </div>

  <div class="col-sm-8">
    <ul class="nav nav-tabs" role="tablist">
      <li class="active">
        <a href="#resources-tab" data-toggle="tab">Resources</a>
      </li>
      <li>
        <a href="#institutions-tab" data-toggle="tab">Institutions</a>
      </li>
      <li>
        <a href="#assessment-questions-tab" data-toggle="tab">Assessment Questions</a>
      </li>
      <li>
        <a href="#activity-tab" data-toggle="tab">Activity</a>
      </li>
    </ul>

    <div class="tab-content">
      <div id="resources-tab" class="tab-pane active">
        <ul class="psap-entity-list">
          <% @format.resources.order(:name).each do |resource| %>
            <li>
              <span class="title">
                <%= entity_icon(resource) %>
                <%= link_to resource.name, resource %>
              </span>
              <br>
              <span class="description">
                <%= entity_icon(Institution) %>
                <%= resource.location.repository.institution.name %>
              </span>
            </li>
          <% end %>
        </ul>
      </div>

      <div id="institutions-tab" class="tab-pane">
        <ul class="psap-entity-list">
          <% @institution_counts.each do |pair| %>
            <li>
              <span class="title"><%= link_to pair[:institution].name, pair[:institution] %></span>
              <small>
                <%= entity_icon(Resource, pluralize(pair[:count], 'resource') + ' of this format') %>
                <%= pair[:count] %>
              </small>
            </li>
          <% end %>
        </ul>
      </div>

      <div id="assessment-questions-tab" class="tab-pane">
        <ul>
          <% @format.assessment_questions.order(:index).each do |question| %>
            <li><%= question.name %></li> <!-- TODO: improve display & show hierarchy -->
          <% end %>
        </ul>
      </div>

      <div id="activity-tab" class="tab-pane">
        <%= render 'shared/events', events: @events %>
      </div>

    </div>
  </div>

</div>
