<% breadcrumbs = []
   breadcrumbs << { 'Institutions' => institutions_path } if current_user.is_admin?
   breadcrumbs << { @location.repository.institution.name =>
                            @location.repository.institution }
   breadcrumbs << { @location.repository.name => @location.repository }
   breadcrumbs << @location.name
%>
<%= breadcrumbs(breadcrumbs) %>

<div class="row">
  <div class="col-sm-6 psap-page-title">
    <h1><%= @location.name %>
      <small><%= entity_icon(@location) %>Location</small>
    </h1>
    <% if @location.description %>
      <p><%= @location.description %></p>
    <% end %>
  </div>
  <div class="col-sm-6">
    <div class="btn-group" style="float:right">
      <!-- Import button -->
      <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          <span class="glyphicon glyphicon-import"></span> Import
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><%= link_to 'From ArchivesSpace', '',
                          'data-toggle' => 'modal', 'data-target' => '#importModal' %></li>
        </ul>
      </div>
      <!-- Edit -->
      <button type="button" class="btn btn-default" data-toggle="modal"
              data-target="#psap-edit-panel">
        <span class="glyphicon glyphicon-pencil"></span>
        Edit
      </button>
      <!-- Assess -->
      <%= link_to location_assess_path(@location), class: 'btn btn-default' do %>
        <%= content_tag(:span, '', class: 'glyphicon glyphicon-stats') %>
        Assess
      <% end %>
      <!-- Delete -->
      <%= link_to location_path(@location), method: 'delete',
                  class: 'btn btn-danger',
                  data: { confirm: 'Deleting this location will also delete '\
                  'all resources it contains. Are you sure you want to '\
                  'delete this location?' } do %>
        <%= content_tag(:span, '', class: 'glyphicon glyphicon-trash') %>
        Delete
      <% end %>
    </div>
  </div>
</div>

<div class="row">

  <div class="col-sm-4">
    <%= render partial: 'shared/entity_hierarchy',
               locals: { entities: [@location.repository],
                         selected_entity: @location,
                         deepest_entity_class: Location,
                         depth: 0 } %>
  </div>

  <div class="col-sm-8">

    <ul class="nav nav-tabs">
      <li role="presentation" class="active">
        <a href="#resources_tab" data-toggle="tab">Resources</a>
      </li>
      <li role="presentation"><a href="#assessment_tab" data-toggle="tab">Assessment</a></li>
      <li role="presentation"><a href="#activity_tab" data-toggle="tab">Activity</a></li>
    </ul>

    <div class="tab-content">

      <div class="tab-pane active" id="resources_tab">
        <!-- Check/Uncheck All button -->
        <div class="btn-group">
          <button type="button" class="btn btn-default btn-sm psap-check-all">
            Check All
          </button>
          <button type="button" class="btn btn-default btn-sm psap-uncheck-all">
            Uncheck All
          </button>
        </div>

        <div class="btn-group" style="float:right">
          <!-- Move Checked button -->
          <button type="button" class="btn btn-default psap-move-checked"
                  data-toggle="modal" data-target="#moveModal"
                  <%= @resources.any? ? '' : 'disabled' %>>
            <i class="fa fa-share"></i> Move Checked
          </button>
          <!-- Add Resource button -->
          <button type="button" class="btn btn-success" data-toggle="modal"
                  data-target="#psap-create-panel">
            <%= entity_icon(Resource) %>
            Add Resource
          </button>
        </div>

        <%= form_tag(resource_move_path) do %>
          <% if @resources.any? %>
            <div id="resources">
              <%= render partial: 'resources/resources',
                         locals: { resources: @resources,
                                   show_checkboxes: true,
                                   show_hierarchy: true } %>
            </div>
          <% else %>
            <p>There are no resources in this location.</p>
          <% end %>
        <% end %>
      </div>

      <div class="tab-pane assessment" id="assessment_tab">

        <div class="psap-progress-container">
          Score: <%= number_to_human(@location.assessment_score * 100) %>
          <div class="progress">
            <div class="progress-bar <%= bootstrap_progress_bar_class_for_score(@location.assessment_score) %> score"
                 role="progressbar"
                 aria-valuenow="<%= @location.assessment_score * 100 %>"
                 aria-valuemin="0" aria-valuemax="100"
                 style="width:<%= @location.assessment_score * 100 %>%;">
            </div>
          </div>
        </div>

        <% @assessment_sections.each do |section| %>
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title"><%= section.name %></h4>
            </div>

            <div class="panel-body">
              <%= render partial: 'shared/assessment_questions',
                         locals: { entity: @location,
                                   assessment_questions: section.assessment_questions.where(parent_id: nil),
                                   depth: 0 } %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="tab-pane" id="activity_tab">
        <%= render 'shared/events', events: @events %>
      </div>

    </div> <!-- .tab-content -->

  </div> <!-- .col-sm-8 -->

</div> <!-- .row -->
