<% provide(:title, "#{@assessment.name} Template") %>
<% provide(:body_id, 'assessment_template') %>

<ol class="breadcrumb">
  <li><%= link_to 'Assessment Templates', assessments_path %></li>
  <li class="active"><%= @assessment.name %> Template</li>
</ol>

<div class="row">
  <div class="col-md-6">
    <h1><%= @assessment.name %> Template</h1>
  </div>
  <div class="col-md-6" style="text-align:right">
    <div class="btn-group">
      <!-- Add Section button -->
      <%= link_to new_assessment_section_path, class: 'btn btn-default' do %>
          <%= content_tag(:span, '', class: 'glyphicon glyphicon-plus') %>
          Add a Section
      <% end %>
      <!-- Add Question button -->
      <%= link_to new_assessment_question_path, class: 'btn btn-default' do %>
          <%= content_tag(:span, '', class: 'glyphicon glyphicon-plus') %>
          Add a Question
      <% end %>
    </div>
  </div>
</div>

<div class="alert alert-info">
  <p>This template contains the content for all new assessments. Changes will
    apply only to assessments begun in the future &mdash; not any that already
    exist. (CONFIRM THIS)</p>
</div>

<div class="row">

  <!-- left column menu -->
  <div class="col-md-3">
    <nav>
      <ul class="nav nav-pills nav-stacked">
        <% i = 0; for section in @assessment.assessment_sections.order(:index) %>
            <li<%= i == 0 ? ' class=active' : '' %> data-open="<%= section.id %>">
              <a href="#<%= section.name.gsub(' ', '_') %>"><%= section.name %></a>
            </li>
        <% i += 1 end %>
      </ul>
    </nav>
  </div>

  <div class="col-md-9 tab-content">
    <% i = 0; for section in @assessment.assessment_sections.order(:index) %>
        <div id="<%= section.name.gsub(' ', '_') %>" class="tab-pane<%= i == 0 ? ' active' : '' %>">
          <div class="row">
            <div class="col-md-7">
              <h2><%= section.name %></h2>
            </div>
            <div class="col-md-5" style="text-align:right">
              <div class="btn-group">
                <!-- Edit Section button -->
                <%= link_to edit_assessment_section_path(section),
                            class: 'btn btn-default', id: 'edit_section_button' do %>
                    <%= content_tag(:span, '', class: 'glyphicon glyphicon-pencil') %>
                    Edit Section
                <% end %>
                <!-- Delete Section button -->
                <%= link_to assessment_section_path(section), method: 'delete',
                            class: 'btn btn-default',
                            data: { confirm: 'Deleting this section will delete '\
                  'all questions it contains. Are '\
                  'you sure you want to delete this section?' } do %>
                    <%= content_tag(:span, '', class: 'glyphicon glyphicon-trash') %>
                    Delete Section
                <% end %>
              </div>
            </div>
          </div>

          <%= render partial: 'assessments/question_tree_rows',
                     locals: {children: section.assessment_questions.where(parent_id: nil).order(:index), depth: 0} %>
        </div>
    <% i += 1 end %>
  </div>

</div>
