<% provide(:title, @institution.name) %>

<ol class="breadcrumb">
  <% if current_user.is_admin? %>
      <li><%= link_to 'Institutions', institutions_path %></li>
  <% end %>
  <li class="active"><%= @institution.name %></li>
</ol>

<h1>
  <%= @institution.name %>
  <%= link_to edit_institution_path(@institution), class: 'btn btn-default btn-sm' do %>
      <%= content_tag(:span, '', class: 'glyphicon glyphicon-pencil') %>
      Edit
  <% end %>
</h1>

<% if @institution.repositories.any? %>

    <table class="table table-striped table-hover">
      <caption>Repositories</caption>
      <thead>
        <th></th>
        <th></th>
        <th></th>
      </thead>
      <tbody>
        <% @institution.repositories.order(:name).each do |repository| %>
          <tr>
            <td>
              <% if current_user.has_permission?('repositories.edit_own') %>
                  <%= link_to 'Edit', edit_repository_path(repository) %>
              <% end %>
            </td>
            <td>
              <% if current_user.has_permission?('repositories.delete_own') %>
                  <%= link_to 'Delete', repository, method: :delete,
                              data: { confirm: 'Are you sure?' } %>
              <% end %>
            </td>
            <td><%= link_to repository.name, repository %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

<% else %>

    <p>This institution has no repositories.</p>

<% end %>

<%= link_to new_institution_repository_path(@institution), class: 'btn btn-default' do %>
    <%= content_tag(:span, '', class: 'glyphicon glyphicon-plus') %>
    Add Repository
<% end %>

<% if @institution.assessments.any? %>

    <table class="table table-striped table-hover">
      <caption>Assessments</caption>
      <thead>
      <th></th>
      <th></th>
      <th></th>
      </thead>
      <tbody>
      <% @institution.assessments.each do |assessment| %>
          <tr>
            <td>
              <%= link_to 'Edit', edit_assessment_path(assessment) %>
            </td>
            <td>
              <%= link_to 'Delete', assessment, method: :delete,
                          data: { confirm: 'Are you sure?' } %>
            </td>
            <td><%= link_to assessment.name, assessment %></td>
          </tr>
      <% end %>
      </tbody>
    </table>

<% else %>

    <p>This institution has not completed any assessments.</p>

<% end %>