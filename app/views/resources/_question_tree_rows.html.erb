<% children.each do |question| %>

    <% options = question.assessment_question_options.order(:index)
    if options.any? %>

        <hr>

        <div class="row depth-<%= depth %>">
          <div class="col-md-12">
            <h3><%= depth > 0 ? raw('&#8627 ') : '' %><%= question.name %></h3>
          </div>
        </div>

        <div class="row depth-<%= depth %>">
          <div class="col-md-12 question">
            <%= f.fields_for :assessment_question_responses do |g| %>
                <% case question.question_type %>
                <% when AssessmentQuestionType::RADIO %>
                    <% options.each do |option| %>
                        <label>
                          <%= g.radio_button :assessment_question_option_id, option.id,
                                             { 'data-option-score' => option.value } %>
                          <%= option.name %>
                        </label>
                        <br>
                    <% end %>
                <% when AssessmentQuestionType::SELECT %>
                    <label>
                      <%= g.select :assessment_question_option_id,
                                   options_for_select(options.map { |op|
                                     [op.name, op.id, { 'data-option-score' => op.value }] }) %>
                    </label>
                <% when AssessmentQuestionType::CHECKBOX %>
                    <% options.each do |option| %>
                        <label>
                          <%= check_box_tag 'resource[assessment_question_responses][assessment_question_option_id]',
                                            option.id,
                                            false, # TODO: fix
                                            { 'data-option-score' => option.value } %>
                          <%= option.name %>
                        </label>
                        <br>
                    <% end %>
                <% end %>

                <p><%= question.help_text %></p>

                <input type="hidden" name="weight" value="<%= question.weight %>">
            <% end %>
          </div>
        </div>

        <%= render partial: 'resources/question_tree_rows',
                   locals: {f: f,
                            children: question.children.order(:index),
                            depth: depth + 1} if question.children.any? %>
    <% end %>
<% end %>
