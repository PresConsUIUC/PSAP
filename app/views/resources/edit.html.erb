<% provide(:title, "Assess #{@resource.name}") %>
<% provide(:body_id, 'edit_resource') %>

<input type="hidden" name="root-url" value="<%= root_url %>">

<ol class="breadcrumb">
  <% if current_user.is_admin? %>
    <li><%= link_to 'Institutions', institutions_path %></li>
  <% end %>
  <li>
    <%= link_to @resource.location.repository.institution.name,
                polymorphic_path(@resource.location.repository.institution) %>
  </li>
  <li>
    <%= link_to @resource.location.repository.name,
                polymorphic_path(@resource.location.repository) %>
  </li>
  <li>
    <%= link_to @resource.location.name,
                polymorphic_path(@resource.location) %>
  </li>
  <li><%= link_to @resource.name, polymorphic_path(@resource) %></li>
  <li class="active">Assess</li>
</ol>

<div class="row">
  <div class="col-sm-10">
    <h1><%= @resource.readable_resource_type %> Assessment: <%= @resource.name %></h1>
  </div>
  <div class="col-sm-2">
    <div class="btn-group" style="float:right">
      <!-- Save -->
      <button type="button" class="btn btn-default save">
        <span class="glyphicon glyphicon-cloud"></span> Save
      </button>
    </div>
  </div>
</div>

<div class="row">

  <!-- left column menu -->
  <div class="col-sm-3">
    <%= render partial: 'shared/assessment_sections',
               locals: { assessment_sections: @assessment_sections } %>
  </div>

  <div class="col-sm-9">

    <%= form_for(@resource, html: { class: 'psap-assessment' }) do |f| %>

      <div id="basic_info" class="section">
        <%= render partial: 'basic_info_form', locals: { f: f } %>
      </div>

      <% # read by JS to select the relevant inputs %>
      <input type="hidden" name="selected_format_class"
             value="<%= @resource.format ? @resource.format.format_class : '' %>">

      <% format = @resource.format
      while format do %>
        <input type="hidden" name="selected_format_ids"
               value="<%= format.id %>">
        <% format = format.parent
      end %>

      <% @resource.assessment_question_responses.each do |response| %>
        <input type="hidden" name="selected_option_ids"
               value="<%= response.assessment_question_option.id %>">
      <% end %>

      <% @assessment_sections.each do |section| %>
        <%= render partial: 'shared/section_form', locals: { section: section } %>
      <% end %>

    <% end %>

  </div>
</div>
